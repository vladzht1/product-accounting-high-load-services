# Product accounting

## Описание решение

Основные пункты задания:

- создать 2 сервиса:
  - сервис по учёту остатков товаров в магазинах
  - сервис истории действий с товарами
- первый сервис должен содержать endpoint'ы:
  - создание товара
  - создание остатка
  - увеличение остатка
  - уменьшение остатка
  - получение остатка по фильтрам (`plu`, `shop_id`, остатку товара по полке (с-по), остатку товара в заказе (с-по))
  - получение товаров по фильтрам (`name`, `plu`)
- второй сервис должен получать все события изменения товаров и остатков
- должен отдавать историю событий с товарами по фильтрам (`shop_id`, `plu`, `date` (с-по), `action`)
- связать сервисы можно любым способом
- СУБД - `PostgreSQL`

## Описание выбранного решения

### Стек

В качестве библиотеки для запуска HTTP сервера в обоих сервисах был использован [express.js](https://expressjs.com/). Первый сервис (учёт товаров и остатков) написан на `TypeScript`, второй (история действий с товарами и остатками) - на `JavaScript`. В обоих сервисах использовался [TypeORM](https://typeorm.io/) ([ts-style](https://typeorm.io/entities) с декораторами в первом сервисе, [js-style](https://typeorm.io/usage-with-javascript#entitycategoryjs) с описанием `EntitySchema` во втором сервисе). Для удобного запуска был настроен [docker-compose](https://docs.docker.com/compose/).

### Архитектура

Оба сервиса были написаны с использованием классической луковичной архитектуры с использованием `IoC (DI)`. В первом сервисе (из-за наличия интерфейсов в `TypeScript`) основные доменные компоненты (репозитории и сервисы) были разделены на интерфейсы и реализацию. Во втором сервисе используются явные типы объекты. Кастомные репозитории изолируют взаимодействие с `ORM`.

### Связь сервисов

Сервисы были связаны при помощи [RabbitMQ](https://www.rabbitmq.com/). На мой взгляд, данный брокер сообщений наиболее хорошо подходит для этой задачи. Отправление событий было изолировано при помощи паттерна `Observer` в первом (основном) сервисе, поэтому при увеличении нагрузки (`>>30 000` запросов в секунду) можно безболезненно переписать взаимодействие сервисов на [Apache Kafka](https://kafka.apache.org/).

## Запуск

Для запуска на компьютере должен быть установлен [Docker](https://www.docker.com/).

```bash
git clone https://github.com/vladzht1/product-accounting-high-load-services

cd product-accounting-high-load-services/task1

# Создать файлы окружения и установить зависимости npm
sh ./scripts/setup.sh

# Запуск
sh ./scripts/run.sh
```
